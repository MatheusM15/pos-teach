ð
;D:\service-orders\src\INFRA\Repositories\OrderRepository.cs
	namespace 	
INFRA
 
. 
Repositories 
; 
public		 
class		 
OrderRepository		 
:		 

Repository		 )
<		) *
Order		* /
>		/ 0
,		0 1
IOrderRepository		2 B
{

 
public 

OrderRepository 
( 
OrderContext '
context( /
)/ 0
:1 2
base3 7
(7 8
context8 ?
)? @
{A B
}C D
public 

async 
Task 
< 
	TSelector 
?  
>  !
GetOrderByIdAsync" 3
<3 4
	TSelector4 =
>= >
(> ?
Guid? C
IdD F
,F G

ExpressionH R
<R S
FuncS W
<W X
OrderX ]
,] ^
	TSelector_ h
>h i
>i j
selectork s
)s t
=> 

await 
_dbSet 
. 
Include 
(  
x  !
=>" $
x% &
.& '
Products' /
)/ 0
.0 1
Where1 6
(6 7
x7 8
=>9 ;
x< =
.= >
Id> @
==A C
IdD F
)F G
.G H
SelectH N
(N O
selectorO W
)W X
.X Y
FirstOrDefaultAsyncY l
(l m
)m n
;n o
} ß
=D:\service-orders\src\INFRA\Repositories\Common\Repository.cs
	namespace 	
INFRA
 
. 
Repositories 
. 
Common #
;# $
public 
class 

Repository 
< 
T 
> 
: 
IRepository (
<( )
T) *
>* +
where, 1
T2 3
:4 5
AggregateRoot6 C
{		 
public

 

DbSet

 
<

 
T

 
>

 
_dbSet

 
{

 
get

  
;

  !
private

" )
set

* -
;

- .
}

/ 0
public 

OrderContext 
_context  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 


Repository 
( 
OrderContext "
context# *
)* +
{ 
_context 
= 
context 
; 
_dbSet 
= 
context 
. 
Set 
< 
T 
> 
(  
)  !
;! "
} 
public 

async 
Task 
< 
IEnumerable !
<! "
T" #
># $
>$ %
GetAllAsync& 1
(1 2

Expression2 <
<< =
Func= A
<A B
TB C
,C D
boolE I
>I J
>J K
?K L
	predicateM V
=W X
nullY ]
)] ^
=> 

await 
_dbSet 
. 
Where 
( 
	predicate '
)' (
.( )
AsNoTracking) 5
(5 6
)6 7
.7 8
ToListAsync8 C
(C D
)D E
;E F
public 

async 
Task 
AddAsync 
( 
T  
entity! '
)' (
=> 

await 
_dbSet 
. 
AddAsync  
(  !
entity! '
)' (
;( )
public 

void 
SaveChangesAsync  
(  !
)! "
=> 

_context 
. 
SaveChanges 
(  
)  !
;! "
public 

async 
Task 
< 
T 
> 
GetByIdAsync %
(% &
Guid& *
id+ -
)- .
=> 

await 
_dbSet 
. 
Where 
( 
x 
=>  "
x# $
.$ %
Id% '
==( *
id+ -
)- .
.. /
FirstOrDefaultAsync/ B
(B C
)C D
;D E
public 

void 
Update 
( 
T 
entity 
)  
=>   

_dbSet   
.   
Update   
(   
entity   
)    
;    !
}!! š
<D:\service-orders\src\INFRA\Repositories\IOrderRepository.cs
	namespace 	
INFRA
 
. 
Repositories 
; 
public 
	interface 
IOrderRepository !
:" #
IRepository$ /
</ 0
Order0 5
>5 6
{ 
public		 

Task		 
<		 
	TSelector		 
>		 
GetOrderByIdAsync		 ,
<		, -
	TSelector		- 6
>		6 7
(		7 8
Guid		8 <
Id		= ?
,		? @

Expression		A K
<		K L
Func		L P
<		P Q
Order		Q V
,		V W
	TSelector		X a
>		a b
>		b c
selector		d l
)		l m
;		m n
}

 ¤

>D:\service-orders\src\INFRA\Repositories\Common\IRepository.cs
	namespace 	
INFRA
 
. 
Repositories 
. 
Common #
;# $
public 
	interface 
IRepository 
< 
T 
> 
where  %
T& '
:( )
AggregateRoot* 7
{ 
Task 
< 	
IEnumerable	 
< 
T 
> 
> 
GetAllAsync $
($ %

Expression% /
</ 0
Func0 4
<4 5
T5 6
,6 7
bool8 <
>< =
>= >
?> ?
	predicate@ I
=J K
nullL P
)P Q
;Q R
Task		 
<		 	
T			 

>		
 
GetByIdAsync		 
(		 
Guid		 
id		  
)		  !
;		! "
Task

 
AddAsync

	 
(

 
T

 
entity

 
)

 
;

 
void 
Update	 
( 
T 
entity 
) 
; 
void 
SaveChangesAsync	 
( 
) 
; 
} ³T
@D:\service-orders\src\INFRA\Migrations\20240707212558_initial.cs
	namespace 	
INFRA
 
. 

Migrations 
{ 
public

 

partial

 
class

 
initial

  
:

! "
	Migration

# ,
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
Number 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 >
,> ?
nullable@ H
:H I
falseJ O
)O P
. 

Annotation #
(# $
$str$ D
,D E)
NpgsqlValueGenerationStrategyF c
.c d#
IdentityByDefaultColumnd {
){ |
,| }

CustomerId 
=  
table! &
.& '
Column' -
<- .
Guid. 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
Discount 
= 
table $
.$ %
Column% +
<+ ,
double, 2
>2 3
(3 4
type4 8
:8 9
$str: L
,L M
nullableN V
:V W
falseX ]
)] ^
,^ _
Status 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
IsPaid 
= 
table "
." #
Column# )
<) *
bool* .
>. /
(/ 0
type0 4
:4 5
$str6 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= W
,W X
nullableY a
:a b
falsec h
)h i
,i j
DeleteAt 
= 
table $
.$ %
Column% +
<+ ,
DateTime, 4
>4 5
(5 6
type6 :
:: ;
$str< V
,V W
nullableX `
:` a
trueb f
)f g
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 0
,0 1
x2 3
=>4 6
x7 8
.8 9
Id9 ;
); <
;< =
}   
)   
;   
migrationBuilder"" 
."" 
CreateTable"" (
(""( )
name## 
:## 
$str## %
,##% &
columns$$ 
:$$ 
table$$ 
=>$$ !
new$$" %
{%% 
Id&& 
=&& 
table&& 
.&& 
Column&& %
<&&% &
Guid&&& *
>&&* +
(&&+ ,
type&&, 0
:&&0 1
$str&&2 8
,&&8 9
nullable&&: B
:&&B C
false&&D I
)&&I J
,&&J K
	ProductId'' 
='' 
table''  %
.''% &
Column''& ,
<'', -
Guid''- 1
>''1 2
(''2 3
type''3 7
:''7 8
$str''9 ?
,''? @
nullable''A I
:''I J
false''K P
)''P Q
,''Q R
Quantity(( 
=(( 
table(( $
.(($ %
Column((% +
<((+ ,
int((, /
>((/ 0
(((0 1
type((1 5
:((5 6
$str((7 @
,((@ A
nullable((B J
:((J K
false((L Q
)((Q R
,((R S
OrderId)) 
=)) 
table)) #
.))# $
Column))$ *
<))* +
Guid))+ /
>))/ 0
())0 1
type))1 5
:))5 6
$str))7 =
,))= >
nullable))? G
:))G H
true))I M
)))M N
,))N O
	CreatedAt** 
=** 
table**  %
.**% &
Column**& ,
<**, -
DateTime**- 5
>**5 6
(**6 7
type**7 ;
:**; <
$str**= W
,**W X
nullable**Y a
:**a b
false**c h
)**h i
,**i j
DeleteAt++ 
=++ 
table++ $
.++$ %
Column++% +
<+++ ,
DateTime++, 4
>++4 5
(++5 6
type++6 :
:++: ;
$str++< V
,++V W
nullable++X `
:++` a
true++b f
)++f g
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% 7
,//7 8
x//9 :
=>//; =
x//> ?
.//? @
Id//@ B
)//B C
;//C D
table00 
.00 

ForeignKey00 $
(00$ %
name11 
:11 
$str11 ?
,11? @
column22 
:22 
x22  !
=>22" $
x22% &
.22& '
OrderId22' .
,22. /
principalTable33 &
:33& '
$str33( 0
,330 1
principalColumn44 '
:44' (
$str44) -
,44- .
onDelete55  
:55  !
ReferentialAction55" 3
.553 4
Cascade554 ;
)55; <
;55< =
}66 
)66 
;66 
migrationBuilder88 
.88 
CreateTable88 (
(88( )
name99 
:99 
$str99 /
,99/ 0
columns:: 
::: 
table:: 
=>:: !
new::" %
{;; 
Id<< 
=<< 
table<< 
.<< 
Column<< %
<<<% &
Guid<<& *
><<* +
(<<+ ,
type<<, 0
:<<0 1
$str<<2 8
,<<8 9
nullable<<: B
:<<B C
false<<D I
)<<I J
,<<J K
Quantity== 
=== 
table== $
.==$ %
Column==% +
<==+ ,
int==, /
>==/ 0
(==0 1
type==1 5
:==5 6
$str==7 @
,==@ A
nullable==B J
:==J K
false==L Q
)==Q R
,==R S
OrderProductId>> "
=>># $
table>>% *
.>>* +
Column>>+ 1
<>>1 2
Guid>>2 6
>>>6 7
(>>7 8
type>>8 <
:>>< =
$str>>> D
,>>D E
nullable>>F N
:>>N O
true>>P T
)>>T U
,>>U V
	CreatedAt?? 
=?? 
table??  %
.??% &
Column??& ,
<??, -
DateTime??- 5
>??5 6
(??6 7
type??7 ;
:??; <
$str??= W
,??W X
nullable??Y a
:??a b
false??c h
)??h i
,??i j
DeleteAt@@ 
=@@ 
table@@ $
.@@$ %
Column@@% +
<@@+ ,
DateTime@@, 4
>@@4 5
(@@5 6
type@@6 :
:@@: ;
$str@@< V
,@@V W
nullable@@X `
:@@` a
true@@b f
)@@f g
}AA 
,AA 
constraintsBB 
:BB 
tableBB "
=>BB# %
{CC 
tableDD 
.DD 

PrimaryKeyDD $
(DD$ %
$strDD% A
,DDA B
xDDC D
=>DDE G
xDDH I
.DDI J
IdDDJ L
)DDL M
;DDM N
tableEE 
.EE 

ForeignKeyEE $
(EE$ %
nameFF 
:FF 
$strFF W
,FFW X
columnGG 
:GG 
xGG  !
=>GG" $
xGG% &
.GG& '
OrderProductIdGG' 5
,GG5 6
principalTableHH &
:HH& '
$strHH( 7
,HH7 8
principalColumnII '
:II' (
$strII) -
,II- .
onDeleteJJ  
:JJ  !
ReferentialActionJJ" 3
.JJ3 4
CascadeJJ4 ;
)JJ; <
;JJ< =
}KK 
)KK 
;KK 
migrationBuilderMM 
.MM 
CreateIndexMM (
(MM( )
nameNN 
:NN 
$strNN A
,NNA B
tableOO 
:OO 
$strOO 0
,OO0 1
columnPP 
:PP 
$strPP (
)PP( )
;PP) *
migrationBuilderRR 
.RR 
CreateIndexRR (
(RR( )
nameSS 
:SS 
$strSS 0
,SS0 1
tableTT 
:TT 
$strTT &
,TT& '
columnUU 
:UU 
$strUU !
)UU! "
;UU" #
}VV 	
	protectedYY 
overrideYY 
voidYY 
DownYY  $
(YY$ %
MigrationBuilderYY% 5
migrationBuilderYY6 F
)YYF G
{ZZ 	
migrationBuilder[[ 
.[[ 
	DropTable[[ &
([[& '
name\\ 
:\\ 
$str\\ /
)\\/ 0
;\\0 1
migrationBuilder^^ 
.^^ 
	DropTable^^ &
(^^& '
name__ 
:__ 
$str__ %
)__% &
;__& '
migrationBuilderaa 
.aa 
	DropTableaa &
(aa& '
namebb 
:bb 
$strbb 
)bb 
;bb  
}cc 	
}dd 
}ee 
3D:\service-orders\src\INFRA\Context\OrderContext.cs
	namespace 	
INFRA
 
. 
Context 
; 
public 
class 
OrderContext 
: 
	DbContext %
{ 
public		 

OrderContext		 
(		 
DbContextOptions		 (
<		( )
OrderContext		) 5
>		5 6
options		7 >
)		> ?
:		@ A
base		B F
(		F G
options		G N
)		N O
{		P Q
}		R S
public 

DbSet 
< 
Order 
> 
Orders 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

DbSet 
< 
OrderProduct 
> 
OrderProducts ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 

DbSet 
< "
OrderProductIngredient '
>' (#
OrderProductIngredients) @
{A B
getC F
;F G
setH K
;K L
}M N
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
modelBuilder9 E
)E F
{ 
modelBuilder 
. 
Entity 
< 
Order !
>! "
(" #
)# $
. 
Property 
( 
o 
=> 
o 
. 
Number #
)# $
. 
ValueGeneratedOnAdd  
(  !
)! "
;" #
base 
. 
OnModelCreating 
( 
modelBuilder )
)) *
;* +
modelBuilder 
. 
Entity 
< 
OrderProduct (
>( )
() *
)* +
. 
HasMany 
( 
o 
=> 
o 
. 
Ingredients '
)' (
. 
WithOne 
( 
) 
. 
OnDelete 
( 
DeleteBehavior $
.$ %
Cascade% ,
), -
;- .
base 
. 
OnModelCreating 
( 
modelBuilder )
)) *
;* +
modelBuilder 
. 
Entity 
< 
Order !
>! "
(" #
)# $
. 
HasMany 
( 
o 
=> 
o 
. 
Products $
)$ %
. 
WithOne 
( 
) 
. 
OnDelete 
( 
DeleteBehavior $
.$ %
Cascade% ,
), -
;- .
}   
}"" 